{# Liste des avenants concernés par cette note de débit #}
<table class="tableau-bordure-zero texte-petit largeur-max marge-top-petit">
    <tr>
        <td colspan="5">Liste détailée d'articles concernés par la note de débit / facture.</td>
    </tr>
    <tr class="texte-gras texte-centre bg-sombre">
        <td class = "tableau-bordure-blanche">N°</td>
        <td class = "tableau-bordure-blanche" style="width: 100px;">Police</td>
        <td class = "tableau-bordure-blanche">Avenant</td>
        <td class = "tableau-bordure-blanche">Risque</td>
        <td class = "tableau-bordure-blanche" style="width: 100px;">Client</td>
        <td class = "tableau-bordure-blanche">Prime nette</td>
        <td class = "tableau-bordure-blanche">Fronting</td>
        <td class = "tableau-bordure-blanche">Taux</td>
        <td class = "tableau-bordure-blanche">Com (ht)</td>
        <td class = "tableau-bordure-blanche">{{taxe.nom}} ({{(taxe.taux * 100)|number_format(0, ',', '.')}}%)</td>
        <td class = "tableau-bordure-blanche">Total dû</td>
    </tr>
    {# C'est ici qu'il faut mettre la boucle pour parcourir tous les comptes bancaires #}

    {# Les variables à cumuler #}
    {% set x = 0 %}
    {% set total_fronting = 0 %}
    {% set total_prime_nette = 0 %}
    {% set total_montant = 0 %}
    {% set total_tva = 0 %}
    {% set total_montant_ttc = 0 %}
    {# fin - Les variables à cumuler #}
    {% set tableauMax = 23 %}

    {% for i in 0..23 %}
        {% if (x % 2) == 0 %}
            <tr class="texte-centre bg-pair">
        {% else %}
            <tr class="texte-centre">
        {% endif %}
                {# Les variables textes #}
                {% set art_numero = x  %}
                {% set art_reference = '12005-33002-0012-13001-00004352-2022' %}
                {% set art_avenant = 'Type@220/id@230' %}
                {% set art_code_produit = 'CDDK' %}
                {% set art_cient = 'Allied Insurance Brokers RDC SA' %}
                
                <td class = "tableau-bordure-blanche" style="width: 25px;">
                    {% include 'segments/_txtLimitedLength.html.twig' with {'txtLimitedLength_texte': art_numero, 'txtLimitedLength_tailleMax': 4} %}
                </td>
                <td class = "tableau-bordure-blanche a-la-ligne-auto" style="width: 170px;">
                    {% include 'segments/_txtLimitedLength.html.twig' with {'txtLimitedLength_texte': art_reference, 'txtLimitedLength_tailleMax': 36} %}
                </td>
                <td class = "tableau-bordure-blanche" style="width: 70px;">
                    {% include 'segments/_txtLimitedLength.html.twig' with {'txtLimitedLength_texte': art_avenant, 'txtLimitedLength_tailleMax': 15} %}
                </td>
                <td class = "tableau-bordure-blanche" style="width: 35px;">
                    {% include 'segments/_txtLimitedLength.html.twig' with {'txtLimitedLength_texte': art_code_produit, 'txtLimitedLength_tailleMax': 4} %}
                </td>
                <td class = "tableau-bordure-blanche a-la-ligne-auto" style="width: 130px;">
                    {% include 'segments/_txtLimitedLength.html.twig' with {'txtLimitedLength_texte': art_cient, 'txtLimitedLength_tailleMax': 31} %}
                </td>
                <td class = "tableau-bordure-blanche texte-droite" style="width: 65px;">{{(1000000)|format_currency(monnaie, {fraction_digit: 2})}}</td>
                <td class = "tableau-bordure-blanche texte-droite" style="width: 65px;">{{(4500)|format_currency(monnaie, {fraction_digit: 2})}}</td>
                <td class = "tableau-bordure-blanche texte-droite" style="width: 40px;">{{15|number_format('2', ',', '.')}}%</td>
                <td class = "tableau-bordure-blanche texte-droite" style="width: 65px;">{{(1500)|format_currency(monnaie, {fraction_digit: 2})}}</td>
                <td class = "tableau-bordure-blanche texte-droite" style="width: 65px;">{{(350)|format_currency(monnaie, {fraction_digit: 2})}}</td>
                <td class = "tableau-bordure-blanche texte-droite" style="width: 65px;">{{(1850)|format_currency(monnaie, {fraction_digit: 2})}}</td>
            </tr>
        {# Ici on incrémente les variables numériques #}
        {% set total_prime_nette = total_prime_nette + 100 %}
        {% set total_fronting = total_fronting + 100 %}
        {% set total_montant = total_montant + 100 %}
        {% set total_tva = total_tva + 0 %}
        {% set total_montant_ttc = total_montant_ttc + 50 %}
        {% set x = x + 1 %}
    {% endfor %}
    
    {# {% for elementFacture in facture.elementFactures %}
        {% if (x % 2) == 0 %}
            <tr class="texte-centre bg-pair">
            {% else %}
            <tr class="texte-centre">
        {% endif %}
                {% set fronting = elementFacture.police.fronting / 100 %}
                {% set prime_nette = elementFacture.police.primenette / 100 %}
                {% set montant = (elementFacture.montant / 100 / (taxe.taux + 1)) %}
                {% set tva = montant * taxe.taux %}
                {% set montant_ttc = (montant + tva) %}
                <td class = "tableau-bordure-blanche" style="width: 25px;">{{(x+1)}}</td>
                <td class = "tableau-bordure-blanche a-la-ligne-auto">{{elementFacture.police.reference}}</td>
                <td class = "tableau-bordure-blanche">Type@{{elementFacture.police.typeAvenant}} / id@{{elementFacture.police.idAvenant}}</td>
                <td class = "tableau-bordure-blanche" style="width: 35px;">{{elementFacture.police.produit.code}}</td>
                <td class = "tableau-bordure-blanche a-la-ligne-auto">{{elementFacture.police.client.nom}}</td>
                <td class = "tableau-bordure-blanche texte-droite">{{(prime_nette)|format_currency(monnaie, {fraction_digit: 2})}}</td>
                <td class = "tableau-bordure-blanche texte-droite">{{(fronting)|format_currency(monnaie, {fraction_digit: 2})}}</td>
                <td class = "tableau-bordure-blanche texte-droite">{{((montant / prime_nette) * 100)|number_format('2', ',', '.')}}%</td>
                <td class = "tableau-bordure-blanche texte-droite">{{(montant)|format_currency(monnaie, {fraction_digit: 2})}}</td>
                <td class = "tableau-bordure-blanche texte-droite">{{(tva)|format_currency(monnaie, {fraction_digit: 2})}}</td>
                <td class = "tableau-bordure-blanche texte-droite">{{(montant_ttc)|format_currency(monnaie, {fraction_digit: 2})}}</td>
            </tr>
            {% set total_fronting = total_fronting + fronting %}
            {% set total_prime_nette = total_prime_nette + prime_nette %}
            {% set total_montant = total_montant + montant %}
            {% set total_tva = total_tva + tva %}
            {% set total_montant_ttc = total_montant_ttc + montant_ttc %}
        {% set x = x + 1 %}
    {% endfor %} #}
    <tr class="texte-gras bg-sombre">
        <td colspan="5" class = "tableau-bordure-blanche">Total général</td>
        <td class = "tableau-bordure-blanche texte-droite">{{total_prime_nette|format_currency(monnaie, {fraction_digit: 2})}}</td>
        <td class = "tableau-bordure-blanche texte-droite">{{total_fronting|format_currency(monnaie, {fraction_digit: 2})}}</td>
        <td class = "tableau-bordure-blanche texte-droite"></td>
        <td class = "tableau-bordure-blanche texte-droite">{{total_montant|format_currency(monnaie, {fraction_digit: 2})}}</td>
        <td class = "tableau-bordure-blanche texte-droite">{{total_tva|format_currency(monnaie, {fraction_digit: 2})}}</td>
        <td class = "tableau-bordure-blanche texte-droite">{{total_montant_ttc|format_currency(monnaie, {fraction_digit: 2})}}</td>
    </tr>
</table>